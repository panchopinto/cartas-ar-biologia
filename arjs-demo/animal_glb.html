<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>RA â€” CÃ©lula Animal (HIRO)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <!-- Gestos tÃ¡ctiles -->
  <script src="https://unpkg.com/aframe-gesture-component/dist/aframe-gesture-component.min.js"></script>

  <style>
    html,body{margin:0;overflow:hidden;background:#000;font-family:system-ui,Arial,sans-serif}
    .hud{position:fixed;left:0;right:0;bottom:0;background:rgba(0,0,0,.65);color:#fff;padding:.6rem .8rem;font-size:.9rem}
    .hud a{color:#8ef}
    #askCam{position:fixed;top:10px;right:10px;z-index:9999;padding:8px 10px;border-radius:10px;border:1px solid #fff3;background:#0008;color:#fff}
  </style>
</head>
<body>

  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    renderer="colorManagement: true; physicallyCorrectLights: true; logarithmicDepthBuffer: true; alpha: true"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; facingMode: environment">

    <!-- Luces -->
    <a-entity light="type: ambient; intensity: 1.1"></a-entity>
    <a-entity light="type: directional; intensity: 1" position="1 2 1"></a-entity>

    <!-- Marcador HIRO -->
    <a-marker preset="hiro" id="marker">
      <a-entity id="model"
        gltf-model="url(../assets/models/animal.glb?v=3)"
        position="0 0 0" rotation="0 0 0" scale="0.22 0.22 0.22"
        gesture-handler="minScale:0.05; maxScale:3; rotationFactor:0.5">
      </a-entity>

      <!-- Cubo de referencia -->
      <a-box position="0.15 0.1 0" depth="0.05" height="0.05" width="0.05" color="#39f"></a-box>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <button id="askCam">Activar cÃ¡mara</button>

  <div class="hud">
    Imprime el marcador <a href="../arjs-demo/hiro_marker.png" target="_blank">HIRO</a>, permite la cÃ¡mara y apunta al marcador.<br/>
    Pincha con dos dedos para <b>zoom</b> y gira con dos dedos para <b>rotar</b>.
  </div>

  <script>
    const btn = document.getElementById('askCam');
    btn.addEventListener('click', async () => {
      try {
        await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: 'environment' } } });
        btn.style.display = 'none';
      } catch (e) {
        alert('No se pudo acceder a la cÃ¡mara. Revisa permisos del sitio (ðŸ”’ > CÃ¡mara > Permitir).');
      }
    });

    document.getElementById('model').addEventListener('object3dset', () => console.log('âœ… Modelo animal cargado'));
    document.getElementById('marker').addEventListener('markerFound', () => console.log('ðŸŽ¯ Marcador detectado'));
  </script>
</body>
</html>
